set -e

echo ""
echo "**************************************************************************"
echo "******************************** clean up ********************************"
echo "**************************************************************************"
echo ""

rm -rf src/templates/cache/
rm -rf mails/

echo ""
echo "**************************************************************************"
echo "****************************** php-cs-fixer ******************************"
echo "**************************************************************************"
echo ""

vendor/bin/php-cs-fixer fix src
vendor/bin/php-cs-fixer fix tests

echo ""
echo "**************************************************************************"
echo "******************************** csfix.php *******************************"
echo "**************************************************************************"
echo ""

php ./csfix.php src
php ./csfix.php tests

echo ""
echo "**************************************************************************"
echo "********************************** phpcs *********************************"
echo "**************************************************************************"
echo ""

vendor/bin/phpcs src --ignore=*/config/*
vendor/bin/phpcs tests

echo ""
echo "**************************************************************************"
echo "********************************* phpcbf *********************************"
echo "**************************************************************************"
echo ""

vendor/bin/phpcbf src
vendor/bin/phpcbf tests

echo ""
echo "**************************************************************************"
echo "********************************* phpstan ********************************"
echo "**************************************************************************"
echo ""

vendor/bin/phpstan analyse --level 8 src
vendor/bin/phpstan analyse --level 8 tests

echo ""
echo "**************************************************************************"
echo "********************************** phpmd *********************************"
echo "**************************************************************************"
echo ""

vendor/bin/phpmd src text cleancode,codesize,controversial,design,naming,unusedcode
vendor/bin/phpmd tests text cleancode,codesize,controversial,design,naming,unusedcode

echo ""
echo "**************************************************************************"
echo "********************************** test **********************************"
echo "**************************************************************************"
echo ""

php test.php

echo "TESTS PASSED"